
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4. Runge-Kutta methods &#8212; Solving Partial Differential Equations - MOOC</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mycss.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="5. First-order derivative and slicing" href="../03_FiniteDifferences/03_01_FirstOrderDerivative_and_Slicing.html" />
    <link rel="prev" title="3. Euler methods" href="02_01_EulerMethod.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Solving Partial Differential Equations - MOOC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../01_Introduction/01_00_Preface.html">
                    Numerical methods for partial differential equations
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01_Introduction/01_01_ToolkitSetup.html">
   1. Toolkit Setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01_Introduction/01_02_TaylorExpansion.html">
   2. Approximations and Taylor expansion
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time integration
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="02_01_EulerMethod.html">
   3. Euler methods
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   4. Runge-Kutta methods
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Finite differences
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../03_FiniteDifferences/03_01_FirstOrderDerivative_and_Slicing.html">
   5. First-order derivative and slicing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_FiniteDifferences/03_02_HigherOrderDerivative_and_Functions.html">
   6. Higher order derivatives, functions and matrix formulation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_FiniteDifferences/03_03_BoundaryValueProblems.html">
   7. Boundary value problems
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Partial differential equations
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../04_PartialDifferentialEquations/04_01_Advection.html">
   8. The first-order wave equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_PartialDifferentialEquations/04_02_StabilityAnalysis.html">
   9. Matrix and modified wavenumber stability analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_PartialDifferentialEquations/04_03_Diffusion_Explicit.html">
   10. One dimensional heat equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_PartialDifferentialEquations/04_04_Diffusion_Implicit.html">
   11. One dimensional heat equation: implicit methods
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Iterative methods
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../05_IterativeMethods/05_01_Iteration_and_2D.html">
   12. Iteration methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05_IterativeMethods/05_02_Conjugate_Gradient.html">
   13. The conjugate gradient method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05_IterativeMethods/05_03_Boosting_Python.html">
   14. Boosting Python
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/aquaULB/solving_pde_mooc/master?urlpath=tree/solving_pde_mooc/notebooks/02_TimeIntegration/02_02_RungeKutta.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/aquaULB/solving_pde_mooc"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/solving_pde_mooc/notebooks/02_TimeIntegration/02_02_RungeKutta.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../../../_sources/solving_pde_mooc/notebooks/02_TimeIntegration/02_02_RungeKutta.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   4.1. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-two-stage-runge-kutta-scheme">
   4.2. A two-stage Runge-Kutta scheme
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-stability-of-a-two-stage-runge-kutta-scheme">
     4.2.1. Numerical stability of a two-stage Runge-Kutta scheme
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-runge-kutta-schemes">
   4.3. General Runge-Kutta schemes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implicit-runge-kutta-schemes">
   4.4. Implicit Runge-Kutta schemes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   4.5. Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   4.6. References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Runge-Kutta methods</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   4.1. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-two-stage-runge-kutta-scheme">
   4.2. A two-stage Runge-Kutta scheme
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-stability-of-a-two-stage-runge-kutta-scheme">
     4.2.1. Numerical stability of a two-stage Runge-Kutta scheme
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-runge-kutta-schemes">
   4.3. General Runge-Kutta schemes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implicit-runge-kutta-schemes">
   4.4. Implicit Runge-Kutta schemes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   4.5. Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   4.6. References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="runge-kutta-methods">
<h1><span class="section-number">4. </span>Runge-Kutta methods<a class="headerlink" href="#runge-kutta-methods" title="Permalink to this headline">#</a></h1>
<section id="introduction">
<h2><span class="section-number">4.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>For convenience, we start with importing some modules needed below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;../styles/mainstyle.use&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the previous notebook we have considered the forward and the backward Euler schemes to time march ordinary differential equations. We have discussed the concept of stability and estimated the accuracy of numerical schemes with respect to the size of the time step.</p>
<p>Here we introduce some more accurate methods with larger domains of stability, that are, therefore, applicable in more complex situations. We only consider systems of first-order differential equations as problems containing higher-order derivatives may be reduced to such systems. Our system of equations thus reads,</p>
<div class="math notranslate nohighlight">
\[    y'(t)=f(t,y)\]</div>
<p>where <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(f\)</span> are vector valued functions.</p>
</section>
<section id="a-two-stage-runge-kutta-scheme">
<h2><span class="section-number">4.2. </span>A two-stage Runge-Kutta scheme<a class="headerlink" href="#a-two-stage-runge-kutta-scheme" title="Permalink to this headline">#</a></h2>
<p>The forward Euler method is defined through:</p>
<div class="math notranslate nohighlight" id="equation-eq-forwardeuler3">
<span class="eqno">(17)<a class="headerlink" href="#equation-eq-forwardeuler3" title="Permalink to this equation">#</a></span>\[y^{n+1} \equiv y^n + f(t^n,y^n) dt \;\;\;\; (\textrm{Forward Euler method}),\]</div>
<p>with all the intermediate times denoted <span class="math notranslate nohighlight">\(t^n = t_0+ndt\)</span>, and the corresponding values of <span class="math notranslate nohighlight">\(y(t)\)</span> as <span class="math notranslate nohighlight">\(y^n = y(t^n)\)</span>.</p>
<p>Graphically, we see that <span class="math notranslate nohighlight">\(y^{n+1}\)</span> is evaluated using the value <span class="math notranslate nohighlight">\(y^n\)</span> and the slope (derivative) of <span class="math notranslate nohighlight">\(y\)</span> at time <span class="math notranslate nohighlight">\(t^n\)</span>:</p>
<a class="reference internal image-reference" href="../../../_images/Euler.png"><img alt="../../../_images/Euler.png" class="align-center" src="../../../_images/Euler.png" style="width: 500px;" /></a>
<p>Runge-Kutta schemes increase the accuracy of the estimated value <span class="math notranslate nohighlight">\(y^{n+1}\)</span> by introducing intermediate times between <span class="math notranslate nohighlight">\(t^n\)</span> and <span class="math notranslate nohighlight">\(t^{n+1}\)</span>, at which the derivative of <span class="math notranslate nohighlight">\(y\)</span> is evaluated and by making use of this information.</p>
<p>The following two-stage Runge-Kutta method is the simplest of such schemes. Graphically, this scheme is defined as follows:</p>
<a class="reference internal image-reference" href="../../../_images/RK2.png"><img alt="../../../_images/RK2.png" class="align-center" src="../../../_images/RK2.png" style="width: 500px;" /></a>
<p>so that,</p>
<div class="math notranslate nohighlight" id="equation-rk2ynp1">
<span class="eqno">(18)<a class="headerlink" href="#equation-rk2ynp1" title="Permalink to this equation">#</a></span>\[\begin{split}    y^* = y^n +\frac{dt}{2}f(t^n, y^n) \\
    y^{n+1} = y^n + dt f(t^n+\frac{dt}{2},y^*)\end{split}\]</div>
<p>In notebook 1.1, we discussed the fact that the forward Euler method is second-order accurate for one time step and first-order accurate for a complete time interval. Here, we hope to improve the accuracy. Let’s check that this is true by evaluating the Taylor expansion of <span class="math notranslate nohighlight">\(y^{n+1}\)</span> in <a class="reference internal" href="#equation-rk2ynp1">(18)</a>.</p>
<div class="math notranslate nohighlight" id="equation-taylorrk2">
<span class="eqno">(19)<a class="headerlink" href="#equation-taylorrk2" title="Permalink to this equation">#</a></span>\[\begin{split} y^{n+1} &amp; = y^n + dt f(t^n+\frac{dt}{2},y^n + \frac{dt}{2}f(t^n, y^n)) \nonumber \\
         &amp; = y^n + dt \left[ f(t^n, y^n) + \frac{dt}{2} \partial_t f(t^n, y^n) + \frac{dt}{2} f(t^n, y^n)\partial_y f(t^n,y^n) + O(dt^2) \right] \nonumber \\
         &amp; = y^n + dt y'^n + \frac{dt^2}{2}y''^n + O(dt^3),\end{split}\]</div>
<p>where we have used the property: <span class="math notranslate nohighlight">\(y''=\partial_t f + f\partial_y f\)</span>. The last equation proves that the two-stage Runge-Kutta method is of third order for one time step and, as a consequence, it is expected to be second-order accurate for a complete time interval.</p>
<section id="numerical-stability-of-a-two-stage-runge-kutta-scheme">
<h3><span class="section-number">4.2.1. </span>Numerical stability of a two-stage Runge-Kutta scheme<a class="headerlink" href="#numerical-stability-of-a-two-stage-runge-kutta-scheme" title="Permalink to this headline">#</a></h3>
<p>Let us now discuss the stability of this two-stage Runge-Kutta method for a general autonomous linear system of differential equations. As usual, we may diagonalize the system defined through the matrix <span class="math notranslate nohighlight">\(f\)</span> and write:</p>
<div class="math notranslate nohighlight">
\[    z' = \Lambda z,\]</div>
<p>where <span class="math notranslate nohighlight">\(\Lambda\)</span> is the diagonal matrix composed of the eigenvalues <span class="math notranslate nohighlight">\(\lambda_k\)</span> of <span class="math notranslate nohighlight">\(f\)</span>, and <span class="math notranslate nohighlight">\(z\)</span> are the coordinates of <span class="math notranslate nohighlight">\(y\)</span> in the eigenbasis.</p>
<p>Using the two-stage Runge-Kutta scheme, we then have,</p>
<div class="math notranslate nohighlight">
\[    z^{n} = (I+ dt \Lambda + \frac{dt^2}{2}\Lambda^2) z^{n-1} \; \Leftrightarrow \; z^{n} = (I+ dt \Lambda + \frac{dt^2}{2}\Lambda^2)^n z^0.\]</div>
<p>All the components of <span class="math notranslate nohighlight">\(z^{n}\)</span> will remain finite for <span class="math notranslate nohighlight">\(n\rightarrow \infty\)</span> as long as the following relation is satisfied for all the eigenvalues <span class="math notranslate nohighlight">\(\lambda_k\)</span>:</p>
<div class="math notranslate nohighlight">
\[    \vert 1+\lambda_k dt + \frac{\lambda_k^2 dt^2}{2} \vert \leq 1.\]</div>
<p>Let us apply the Runge-Kutta scheme to the problem of a body in free fall. The system of differential equations reads:</p>
<div class="math notranslate nohighlight">
\[\begin{split}    \begin{cases}
    &amp; \displaystyle \frac{dh}{dt}=v,\\
    &amp; \displaystyle \frac{dv}{dt}=-g.
    \end{cases}\end{split}\]</div>
<p>Rephrasing it in matrix form we get:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{d}{dt}
\begin{pmatrix}
    h \\
    v
\end{pmatrix}
=
&amp; \begin{pmatrix}
    0 &amp; 1 \\
    0 &amp; 0
\end{pmatrix}
\begin{pmatrix}
    h \\
    v
\end{pmatrix}
+
\begin{pmatrix}
    0 \\
    -g
\end{pmatrix}
\nonumber\end{split}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-free-fall">
<span class="eqno">(20)<a class="headerlink" href="#equation-eq-free-fall" title="Permalink to this equation">#</a></span>\[\Leftrightarrow
\frac{dy}{dt} = Ly + b\]</div>
<p>with <span class="math notranslate nohighlight">\(y=(h\;\; v)\)</span>, <span class="math notranslate nohighlight">\(b=(0\;\; -g)\)</span> and, obviously,</p>
<div class="math notranslate nohighlight">
\[\begin{split}L=
\begin{pmatrix}
    0 &amp; 1 \\
    0 &amp; 0
\end{pmatrix}.\end{split}\]</div>
<p>As <span class="math notranslate nohighlight">\(L\)</span> and <span class="math notranslate nohighlight">\(b\)</span> are constant, the two-stage Runge-Kutta scheme applied to <a class="reference internal" href="#equation-eq-free-fall">(20)</a> becomes:</p>
<ol class="simple">
<li><p><span class="math notranslate nohighlight">\(\displaystyle y^* = y^n + \frac{dt}{2} (Ly^n+b),\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\displaystyle y^{n+1} = y^n + dt(Ly^*+b).\)</span></p></li>
</ol>
<p>Let’s implement this procedure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>  <span class="c1"># ms^-2, gravitational constant</span>
<span class="n">h0</span> <span class="o">=</span> <span class="mf">100.</span> <span class="c1"># m, initial height</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mf">0.</span>   <span class="c1"># ms^-1, initial speed</span>

<span class="n">ti</span> <span class="o">=</span> <span class="mf">0.</span>   <span class="c1"># s, initial time</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mf">4.0</span>  <span class="c1"># s, final time at which to seek the solution</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># s, time step</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">tf</span><span class="o">-</span><span class="n">ti</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>

<span class="c1"># Create a numpy array to contain the</span>
<span class="c1"># intermediate values of y, including</span>
<span class="c1"># those at ti and tf.</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Store initial condition in y[0].</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h0</span><span class="p">,</span> <span class="n">v0</span>

<span class="c1"># Create vector b.</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">g</span><span class="p">])</span>

<span class="c1"># Create matrix L.</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]])</span>

<span class="c1"># Perform the two-stage time stepping.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
    <span class="n">y_star</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
    <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">y_star</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># array for the time interval data</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
</pre></div>
</div>
</div>
</div>
<p>We visualize the solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$v$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Speed vs time (m/s)&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Height vs time (m)&#39;</span><span class="p">)</span>

<span class="c1"># Let us bind the axes to the relevant</span>
<span class="c1"># interval.</span>
<span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_02_RungeKutta_7_0.png" src="../../../_images/02_02_RungeKutta_7_0.png" />
</div>
</div>
</section>
</section>
<section id="general-runge-kutta-schemes">
<h2><span class="section-number">4.3. </span>General Runge-Kutta schemes<a class="headerlink" href="#general-runge-kutta-schemes" title="Permalink to this headline">#</a></h2>
<p>General Runge-Kutta schemes are defined as follows <a class="footnote-reference brackets" href="#footcite-hairer1987" id="id1">1</a>:</p>
<div class="math notranslate nohighlight" id="equation-eq-rk-gen-exp">
<span class="eqno">(21)<a class="headerlink" href="#equation-eq-rk-gen-exp" title="Permalink to this equation">#</a></span>\[\begin{split} y^{n+1} &amp;= y^n + dt(b_1 k_1 + \cdots + b_s k_s) \nonumber \\
 k_1 &amp; = f(t^n, y^n) \nonumber \\
 k_2 &amp; = f(t^n + c_2 dt, y^n + dta_{21}k_1) \nonumber \\
 k_3 &amp; = f(t^n + c_3 dt, y^n + dt(a_{31}k_1+a_{32}k_2)) \nonumber \\
 &amp; \cdots \nonumber \\
 k_s &amp; = f(t^n + c_s dt, y^n + dt(a_{s1}k_1+\cdots + a_{s,s-1}k_{s-1}))\end{split}\]</div>
<p>Some constraints are then put on all the coefficients to achieve a given order of accuracy <span class="math notranslate nohighlight">\(O(dt^p)\)</span> for <span class="math notranslate nohighlight">\(y^{n+1}\)</span>. One says that the <span class="math notranslate nohighlight">\(s\)</span>-stage Runge-Kutta method is of order <span class="math notranslate nohighlight">\(p\)</span>.</p>
<p>The construction of higher order Runge-Kutta schemes is in fact quite complicated, and has been the subject of a vast literature (some in-depth review of the Runge-Kutta methods may be found in <a class="footnote-reference brackets" href="#footcite-butcher2008" id="id2">2</a> or <a class="footnote-reference brackets" href="#footcite-hairer1987" id="id3">1</a>). There is no systematic way to obtain order <span class="math notranslate nohighlight">\(p\)</span> methods with a minimum number of stages <span class="math notranslate nohighlight">\(s\)</span>. One can achieve order <span class="math notranslate nohighlight">\(p\)</span> with <span class="math notranslate nohighlight">\(s=p\)</span> up to <span class="math notranslate nohighlight">\(p=4\)</span>. For <span class="math notranslate nohighlight">\(p=5\)</span> and <span class="math notranslate nohighlight">\(p=6\)</span> one needs at least <span class="math notranslate nohighlight">\(s=p+1\)</span> stages. For <span class="math notranslate nohighlight">\(p=7\)</span> and <span class="math notranslate nohighlight">\(p=8\)</span> the minimum number of stages are respectively <span class="math notranslate nohighlight">\(s=9\)</span> and <span class="math notranslate nohighlight">\(s=11\)</span>.</p>
<blockquote>
<div><p>Above this, very little is known <a class="footnote-reference brackets" href="#footcite-butcher1996" id="id4">3</a>.</p>
</div></blockquote>
<p>Therefore, we focus here our attention on a general purpose <strong>fourth-order Runge-Kutta scheme</strong>, that is accurate and stable enough for all the problems we consider in the rest of this course (from now on we call it <strong>RK4</strong>). It was introduced in 1901 by W. Kutta and reads <a class="footnote-reference brackets" href="#footcite-kutta1901" id="id5">4</a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}    y^{n+1} &amp; = y^n + \frac16 k_1 + \frac13(k_2 + k_3) + \frac16 k_4 \nonumber \\
    k_1 &amp; = dtf(t^n,y^n) \\
    k_2 &amp; = dtf(t^n+\frac{dt}{2},y^n+\frac12 k_1) \\
    k_3 &amp; = dtf(t^n+\frac{dt}{2},y^n+\frac12 k_2) \\
    k_4 &amp; = dtf(t^n+dt,y^n+k_3)\end{split}\]</div>
<p>For an autonomous linear system, it is straightforward to prove that this method is indeed fifth-order accurate for one time step. After diagonalization, we have:</p>
<div class="math notranslate nohighlight">
\[\begin{split}  z^{n+1} &amp; = z^n + \frac16 dt \Lambda z^n + \frac13 dt \Lambda (z^n + \frac12 dt \Lambda z^n ) + \frac13 dt \Lambda (z^n + \frac12 dt \Lambda (z^n + \frac12 dt \Lambda z^n)) \nonumber \\
   &amp; +\frac16 dt \Lambda (z^n + dt \Lambda (z^n + \frac12 dt \Lambda (z^n + \frac12 dt \Lambda z^n))) \nonumber \\
  &amp; = z^n + dt \Lambda z^n + \frac{dt^2}{2}\Lambda^2 z^n + \frac{dt^3}6 \Lambda^3 z^n + \frac{dt^4}{24} \Lambda^4 z^n\end{split}\]</div>
<p>The last expression coincides with the Taylor expansion of <span class="math notranslate nohighlight">\(z^{n+1}\)</span> up to fourth order. For a non-linear system, one can also prove that RK4 is of fourth order but it is a tedious task.</p>
<p>In terms of stability, we also see that the RK4 method is stable for a general autonomous linear system as long as all the eigenvalues of the operator <span class="math notranslate nohighlight">\(f\)</span> satisfy,</p>
<div class="math notranslate nohighlight">
\[    \vert 1+\lambda_k dt + \frac{\lambda_k^2 dt^2}{2} + \frac{\lambda_k^3 dt^3}{6} + \frac{\lambda_k^4 dt^4}{24}\vert \leq 1.\]</div>
<p>In the following plot, we compare the regions of stability for the various schemes we have already discussed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># As before, the x-axis corresponds to</span>
<span class="c1"># lambda_r*dt and the y-axis to lambda_i*dt.</span>
<span class="c1"># We set the resolution along x and y</span>
<span class="c1"># (in points per the whole 1D domain).</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">ny</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We create numpy arrays, which store the</span>
<span class="c1"># x-points and the y-points.</span>
<span class="c1"># numpy.linspace is another way to create a</span>
<span class="c1"># numpy array for a sequence of numbers</span>
<span class="c1"># in some range, alternatively to numpy.arange.</span>
<span class="c1"># We must pass starting and end points to</span>
<span class="c1"># the linspace function. Unlike the arange</span>
<span class="c1"># function, here we set number of points</span>
<span class="c1"># we want to put between, instead of the</span>
<span class="c1"># distance between the points.</span>
<span class="c1"># Also note that, while numpy.arange does</span>
<span class="c1"># NOT include the end point you pass into</span>
<span class="c1"># the array, linspace does include it.</span>
<span class="c1">#</span>
<span class="c1"># For more info</span>
<span class="c1"># https://numpy.org/doc/stable/reference/generated/numpy.linspace.html</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>

<span class="c1"># The purpose of numpy.meshgrid can be</span>
<span class="c1"># pretty much assumed from the name of the</span>
<span class="c1"># function. meshgrid creates the ND coor-</span>
<span class="c1"># dinate arrays from the 1D sets of coor-</span>
<span class="c1"># dinates. In more simple words, when you</span>
<span class="c1"># pass, for example, two 1D arrays, repre-</span>
<span class="c1"># senting the coordinates along two axes,</span>
<span class="c1"># meshgrid returns two 2D arrays. The first</span>
<span class="c1"># one contains x-coordinates for each</span>
<span class="c1"># gridline drawn parallel to x-axis, and</span>
<span class="c1"># the second one contains y-coordinates</span>
<span class="c1"># for each gridline drawn parallel to</span>
<span class="c1"># y-axis, respectively.</span>
<span class="c1">#</span>
<span class="c1"># For more info</span>
<span class="c1"># https://numpy.org/doc/stable/reference/generated/numpy.meshgrid.html?highlight=meshgrid</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Go to the space of complex numbers.</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">Y</span>

<span class="c1"># Terms remaining from Taylor expansion for</span>
<span class="c1"># the Euler scheme.</span>
<span class="n">sigma1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Z</span>

<span class="c1"># We compute the norm of sigma1.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">sigma1</span><span class="o">*</span><span class="n">sigma1</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>

<span class="c1"># Terms remaining from Taylor expansion for</span>
<span class="c1"># the RK2.</span>
<span class="n">sigma2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Z</span> <span class="o">+</span> <span class="n">Z</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.</span>

<span class="n">norm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">sigma2</span><span class="o">*</span><span class="n">sigma2</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>

<span class="c1"># Terms remaining from Taylor expansion for</span>
<span class="c1"># the RK4.</span>
<span class="n">sigma4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Z</span> <span class="o">+</span> <span class="n">Z</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.</span> <span class="o">+</span> <span class="n">Z</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mf">6.</span> <span class="o">+</span> <span class="n">Z</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mf">24.</span>

<span class="n">norm4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">sigma4</span><span class="o">*</span><span class="n">sigma4</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># We shall now use the</span>
<span class="c1"># matplotlib.pyplot.contour function.</span>
<span class="c1"># As X and Y, we pass the mesh data. Let</span>
<span class="c1"># f(x, y)=g(x, y) + C be some function</span>
<span class="c1"># where C is a constant. Imagine</span>
<span class="c1"># we want to plot contour lines for the</span>
<span class="c1"># set of integer values of C=0,-1,-2,-3,...</span>
<span class="c1"># They will be described by equations</span>
<span class="c1"># g(x, y) = 0, g(x, y) = 1, g(x, y) = 2,...</span>
<span class="c1">#</span>
<span class="c1"># That&#39;s what the contour function does.</span>
<span class="c1"># For example, if given the equation of</span>
<span class="c1"># circle, contour function will plot the</span>
<span class="c1"># contour lines for (x-a)^2+(y-b)^2=0,1,2,...</span>
<span class="c1">#</span>
<span class="c1"># For more info</span>
<span class="c1"># https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.contour.html</span>
<span class="c1">#</span>
<span class="c1"># matplotlib.pyplot.contour provides us</span>
<span class="c1"># exactly the tool we want, as our condi-</span>
<span class="c1"># tion for stability is given by an expression</span>
<span class="c1"># of the kind f(x, y) &lt;= 1. The only thing we</span>
<span class="c1"># have to do is to display o n l y that contour line</span>
<span class="c1"># which corresponds to C=-1.</span>
<span class="c1">#</span>
<span class="c1"># When passing certain levels to the contour</span>
<span class="c1"># function, the datatype must be either a single</span>
<span class="c1"># integer, or a sequence of integers (list,</span>
<span class="c1"># tuple, numpy.ndarray...). When contours at</span>
<span class="c1"># certain levels are of interest, then we must</span>
<span class="c1"># use an array-like object.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">norm1</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">norm2</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">norm4</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.4</span>
<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.4</span><span class="p">,</span> <span class="mf">3.4</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span> <span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">head_width</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">20.</span><span class="o">*</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">),</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">20.</span><span class="o">*</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">),</span>
         <span class="n">overhang</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">head_width</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">20.</span><span class="o">*</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">),</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">20.</span><span class="o">*</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">),</span>
         <span class="n">overhang</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.475</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Label contours</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Euler&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;RK2&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">2.05</span><span class="p">,</span> <span class="mf">2.05</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;RK4&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="c1"># Notable points</span>
<span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.63</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">head_width</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">80.</span><span class="o">*</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">),</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">50.</span><span class="o">*</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">),</span>
         <span class="n">overhang</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.55</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;2.83&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="o">-</span><span class="mf">3.05</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="n">head_width</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">80.</span><span class="o">*</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">),</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">50.</span><span class="o">*</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">),</span>
         <span class="n">overhang</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">clip_on</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">3.17</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;-2.79&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="c1"># Axis labels</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\lambda_r dt$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\lambda_i dt$&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability regions&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.01</span><span class="p">)</span>

<span class="c1"># fig.savefig(&#39;../figures/stabilityDomains.png&#39;, dpi=300)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.7, 1.01, &#39;Stability regions&#39;)
</pre></div>
</div>
<img alt="../../../_images/02_02_RungeKutta_11_1.png" src="../../../_images/02_02_RungeKutta_11_1.png" />
</div>
</div>
<p>We already pointed out that the forward Euler scheme is unstable if one of the eigenvalues of our system is purely imaginary (as in the case of the harmonic oscillator). Although the RK2 scheme’s domain of stability is larger, the scheme has the same property. Of all the schemes considered so far, RK4 has a significantly larger domain of stability and, more importantly, it does englobe a part of the imaginary axis, so, it can handle problems with purely imaginary eigenvalues!</p>
</section>
<section id="implicit-runge-kutta-schemes">
<h2><span class="section-number">4.4. </span>Implicit Runge-Kutta schemes<a class="headerlink" href="#implicit-runge-kutta-schemes" title="Permalink to this headline">#</a></h2>
<p>We have discussed that explicit Runge-Kutta schemes become quite complicated as the order of accuracy increases. Implicit Runge-Kutta methods might appear to be even more of a headache, especially at higher-order of accuracy <span class="math notranslate nohighlight">\(p\)</span>. We will give a very brief introduction into the subject, so that you get an impression.</p>
<p>Generally speaking, RK methods can be defined as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp; y^{n+1} = y^n + dt\sum_{i}^{s} b_i k_i,\nonumber\\
&amp; k_i = f(t^n + c_i dt, y^n + dt\sum_{j=1}^h a_{ij} k_j).\end{split}\]</div>
<p>For explicit RK methods one has <span class="math notranslate nohighlight">\(h=s-1\)</span>. This implies that any <span class="math notranslate nohighlight">\(k_i\)</span> can be computed explicitly from the knowledge of the previously computed <span class="math notranslate nohighlight">\(k_j\)</span> with <span class="math notranslate nohighlight">\(j&lt;i\)</span>. For implicit RK methods, we have <span class="math notranslate nohighlight">\(h=s\)</span>. It mean, that for each <span class="math notranslate nohighlight">\(k_i\)</span> we have to solve an implicit equation <span class="math notranslate nohighlight">\(k_i=f(k_1, k_2,\dots,k_i)\)</span>. We pay a price in terms of complexity (we have to invert some matrix or iteratively find a solution to the previous equation). However, implicit RK methods have better stability properties compared to explicit ones and can therefore be used for a larger set of problems.</p>
<p>As an example, let us consider some relatively simple implicit RK scheme - we went on <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_Runge%E2%80%93Kutta_methods">Wikipedia</a> and picked one named <em>Qin and Zhang’s two-stage second-order</em> implicit method. It reads:</p>
<div class="math notranslate nohighlight">
\[\begin{split}y^{n+1} &amp;= y^n + \frac{1}{2}(k_1 + k_2),\nonumber \\
k_1 &amp;= f(t^n+\frac{dt}{4}, y^n+\frac{dt}{4}k_1),\nonumber \\
k_2 &amp;= f(t^n+\frac{3}{4}dt, y^n+dt(\frac{1}{2}k_1+\frac{1}{4}k_2)).\end{split}\]</div>
<p>Let’s implement it for the problem of a body in free fall described by <a class="reference internal" href="#equation-eq-free-fall">(20)</a>. Make sure you understand the implementation of the implicit scheme in the code…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>  <span class="c1"># ms^-2, gravitational constant</span>
<span class="n">h0</span> <span class="o">=</span> <span class="mf">100.</span> <span class="c1"># m, initial height</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mf">0.</span>   <span class="c1"># ms^-1, initial speed</span>

<span class="n">ti</span> <span class="o">=</span> <span class="mf">0.</span>   <span class="c1"># s, initial time</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># s, final time at which to seek the solution</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># s, time step</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">tf</span><span class="o">-</span><span class="n">ti</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>

<span class="c1"># Create numpy arrays to contain the</span>
<span class="c1"># intermediate values of y</span>
<span class="n">y_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="c1"># Explicit RK2</span>
<span class="n">y_imp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="c1"># Implicit RK2</span>

<span class="c1"># Store initial condition in y[0, :].</span>
<span class="n">y_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h0</span><span class="p">,</span> <span class="n">v0</span>
<span class="n">y_imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h0</span><span class="p">,</span> <span class="n">v0</span>

<span class="c1"># Create vector b.</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">g</span><span class="p">])</span>

<span class="c1"># Create matrix L.</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]])</span>

<span class="c1"># Compute the constant matrix needed in</span>
<span class="c1"># the implement implicit RK scheme.</span>
<span class="c1"># numpy.eye returns a unity matrix.</span>
<span class="c1"># The argument defines the shape of the matrix.</span>
<span class="c1"># There is a possibility to shift the dia-</span>
<span class="c1"># gonal if needed.</span>
<span class="c1">#</span>
<span class="c1"># For more info</span>
<span class="c1"># https://numpy.org/doc/stable/reference/generated/numpy.eye.html</span>
<span class="n">mat_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">L</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="mf">4.</span><span class="p">)</span>

<span class="c1"># Perform the time stepping according to</span>
<span class="c1"># both explicit and implicit schemes in</span>
<span class="c1"># one loop.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
    <span class="c1"># Explicit time stepping</span>
    <span class="n">y_star</span> <span class="o">=</span> <span class="n">y_exp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">y_exp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
    <span class="n">y_exp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_exp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">y_star</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>

    <span class="c1"># Implicit scheme time stepping.</span>
    <span class="n">k_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat_k</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">y_imp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
    <span class="n">k_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">mat_k</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">y_imp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">k_1</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
    <span class="n">y_imp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_imp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">k_1</span><span class="o">+</span><span class="n">k_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s now plot our solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_exp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_imp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$v$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Speed vs time (m/s)&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_exp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_imp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$h$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Height vs time (m)&#39;</span><span class="p">)</span>

<span class="c1"># Let us bind the axes to the relevant</span>
<span class="c1"># interval.</span>
<span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_02_RungeKutta_17_0.png" src="../../../_images/02_02_RungeKutta_17_0.png" />
</div>
</div>
</section>
<section id="summary">
<h2><span class="section-number">4.5. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">#</a></h2>
<p>In this notebook we have introduced a family of Runge-Kutta explicit and implicit methods. While we won’t consider Runge-Kutta schemes of order higher than 4 in the course, we discussed the complexities one would face trying to construct equations for the coefficients <span class="math notranslate nohighlight">\(k_i\)</span> for higher-order schemes. We also gave insight into implicit Runge-Kutta schemes and provided an implementation of Qin and Zhang’s second-order implicit method.</p>
<p>With this we conclude the chapter dedicated to <strong>time integration</strong>. In the following chapter we will consider the finite differences method to approximate derivatives in partial differential equations and convert them into a system of linear equations.</p>
</section>
<section id="references">
<h2><span class="section-number">4.6. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h2>
<div class="docutils container" id="id6">
<dl class="footnote brackets">
<dt class="label" id="footcite-hairer1987"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id3">2</a>)</span></dt>
<dd><p>Ernst Hairer, Syvert Paul Norsett, and Gerhard Wanner. <em>Solving Ordinary Differential Equations I: Nonstiff Problems: With 105 Figures</em>. Springer-Verlag, 1987.</p>
</dd>
<dt class="label" id="footcite-butcher2008"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>John Charles Butcher and Nicolette Goodwin. <em>Numerical methods for ordinary differential equations</em>. Wiley Online Library, 2008.</p>
</dd>
<dt class="label" id="footcite-butcher1996"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>J.C. Butcher. A history of Runge-Kutta methods. <em>Applied Numerical Mathematics</em>, 20(3):247–260, 1996. <a class="reference external" href="https://doi.org/10.1016/0168-9274(95)00108-5">doi:10.1016/0168-9274(95)00108-5</a>.</p>
</dd>
<dt class="label" id="footcite-kutta1901"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Wilhelm Kutta. Beitrag zur naherungsweisen integration totaler differentialgleichungen. <em>Z. Math. Phys.</em>, 46:435–453, 1901.</p>
</dd>
</dl>
</div>
<hr class="footnotes docutils" />
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./solving_pde_mooc/notebooks/02_TimeIntegration"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="02_01_EulerMethod.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">3. </span>Euler methods</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../03_FiniteDifferences/03_01_FirstOrderDerivative_and_Slicing.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5. </span>First-order derivative and slicing</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By B. Knaepen & Y. Velizhanina<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>